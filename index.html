
<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>变量道 · 心理自救｜Variable Dao</title>
<meta name="description" content="变量道 · 心理自救｜把现实当素材来书写。四语切换（中/英/日/韩），移动端优先，可直接部署 GitHub Pages。">
<style>
  :root{--maxw:980px;--pad:16px;--radius:14px;--accent:#4b6bfb}
  html,body{margin:0;padding:0}
  body{font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","PingFang SC","Hiragino Sans GB","Microsoft YaHei","Apple SD Gothic Neo","Malgun Gothic",sans-serif;line-height:1.65;-webkit-font-smoothing:antialiased;color:#111;background:#fff}
  a{color:var(--accent);text-decoration:none}
  header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(150%) blur(8px);background:rgba(255,255,255,.78);border-bottom:1px solid rgba(0,0,0,.06)}
  @media (prefers-color-scheme:dark){
    body{background:#0b0b0d;color:#eaeaf0}
    header{background:rgba(11,11,13,.6);border-bottom:1px solid rgba(255,255,255,.08)}
    .card,.panel{background:#141418;border-color:#24242a;color:#eaeaf0}
  }
  .nav{max-width:var(--maxw);margin:0 auto;padding:10px var(--pad);display:flex;align-items:center;gap:10px;white-space:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch}
  .brand{font-weight:800;letter-spacing:.2px;white-space:nowrap}
  .grow{flex:1;min-width:12px}
  .chip,select{padding:6px 10px;border:1px solid rgba(0,0,0,.08);border-radius:999px;background:transparent;color:inherit}
  @media (prefers-color-scheme:dark){ .chip,select{border-color:rgba(255,255,255,.12)}}
  .hero{max-width:var(--maxw);margin:28px auto 18px;padding:0 var(--pad)}
  .h1{font-size:clamp(28px,4.6vw,46px);line-height:1.15;font-weight:900}
  .lead{font-size:clamp(15px,2.4vw,18px);opacity:.92}
  .btn{display:inline-flex;align-items:center;gap:10px;padding:14px 18px;border-radius:14px;border:1px solid rgba(0,0,0,.08);background:linear-gradient(180deg,#fff,#f6f7fb);box-shadow:0 8px 20px rgba(0,0,0,.08);font-weight:800;cursor:pointer}
  @media (prefers-color-scheme:dark){ .btn{background:linear-gradient(180deg,#1a1a1f,#121218);border-color:#24242a;box-shadow:0 8px 28px rgba(0,0,0,.35)}}
  .panel{max-width:var(--maxw);margin:8px auto 60px;padding:0 var(--pad)}
  .cards{display:grid;grid-template-columns:1fr;gap:14px}
  .card{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:var(--radius);padding:14px 16px}
  .card h3{margin:6px 0 8px;font-size:18px}
  .muted{opacity:.7}
  .section{display:none}
  .section.active{display:block}
  .detail{display:none}
  .detail.active{display:block}
  .detail .back{position:sticky;top:56px;z-index:9;margin-bottom:10px}
  .back button{padding:10px 12px;border-radius:12px;border:1px solid rgba(0,0,0,.08);background:transparent;color:inherit}
  footer{padding:24px var(--pad) 60px;border-top:1px solid rgba(0,0,0,.06);margin-top:40px}
  .foot{max-width:var(--maxw);margin:0 auto}
  .note{font-size:13px;opacity:.7}
  body.layout-desktop .cards{grid-template-columns:repeat(2,1fr)}
  body.layout-desktop .h1{font-size:46px}
  body.layout-desktop .panel,.hero{max-width:1180px}
  #toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:rgba(20,20,30,.9);color:#fff;padding:8px 12px;border-radius:999px;font-size:13px;display:none}
</style>
</head>
<body>
<header>
  <div class="nav">
    <div class="brand"><a href="#" id="nav-home-link">变量道 · Variable Dao</a></div>
    <div class="grow"></div>
    <a class="chip" href="#" id="nav-home" data-i18n="nav.home">首页</a>
    <a class="chip" href="#" id="nav-stories" data-i18n="nav.stories">故事</a>
    <a class="chip" href="#" id="nav-about" data-i18n="nav.about">关于我们</a>
    <select id="layoutSelect" title="layout" class="chip">
      <option value="mobile">📱 Mobile</option>
      <option value="desktop">🖥️ Desktop</option>
    </select>
    <select id="langSelect" title="language" class="chip">
      <option value="zh">中文</option>
      <option value="en">EN</option>
      <option value="ja">日本語</option>
      <option value="ko">한국어</option>
    </select>
  </div>
</header>

<!-- Step1: Home Hero -->
<section id="home-hero" class="section active">
  <div class="hero">
    <div class="h1" data-i18n="hero.title">变量道 · 心理自救</div>
    <p class="lead" data-i18n="hero.subtitle1">他们给你故事，你只被分配到角色。我们给你笔。</p>
    <p class="lead" data-i18n="hero.subtitle2">思维进化，不逃避不妄想——把现实当素材来书写。从此，故事听你的。</p>
    <div style="height:14px"></div>
    <button id="startBtn" class="btn" data-i18n="hero.cta">我来执笔</button>
    <div class="note" style="margin-top:10px" data-i18n="hero.note">点击“我来执笔”进入下一步。可随时用顶部导航返回。</div>
  </div>
</section>

<!-- Step2: Home Cards -->
<section id="home-cards" class="section">
  <div class="panel">
    <div class="h1" data-i18n="cards.title">看到哪条让你想爆粗口，就点它。</div>
    <div class="cards" id="cardsList"></div>
  </div>
  <div class="panel detail" id="detailView">
    <div class="back"><button id="backToCards">🔙 <span data-i18n="cards.back">返回选卡</span></button></div>
    <div id="detailContent" class="card"></div>
  </div>
</section>

<!-- Stories -->
<section id="stories" class="section">
  <div class="panel">
    <div class="card">
      <h3 data-i18n="stories.title">故事</h3>
      <p data-i18n="stories.wip">内容正在搭建中，敬请期待。</p>
    </div>
  </div>
</section>

<!-- About -->
<section id="about" class="section">
  <div class="panel">
    <div class="cards" id="aboutCards"></div>
  </div>
  <div class="panel">
    <div class="card">
      <h4 data-i18n="about.statement.title">声明：我们的承诺与界线</h4>
      <ul class="long" id="aboutStatement"></ul>
      <p class="note">Email: <a href="mailto:notpreset@outlook.com">notpreset@outlook.com</a></p>
    </div>
  </div>
</section>

<footer>
  <div class="foot">
    <div class="note" data-i18n="footer.copy">© 2025 变量道 · 让世界成为可书写的素材。</div>
  </div>
</footer>

<div id="toast"></div>

<script>
// ================= i18n UI strings =================
const I18N = {
  en: {
    "nav.home":"Home","nav.stories":"Stories","nav.about":"About",
    "hero.title":"Variable Dao · Self-Rescue by Story",
    "hero.subtitle1":"They hand you a story and assign a role. We hand you the pen.",
    "hero.subtitle2":"Evolve your thinking — no escapism, no delusion. Write with reality as your material. From now on, the story listens to you.",
    "hero.cta":"Take the Pen","hero.note":"Click the button to continue. Use the top nav anytime.",
    "cards.title":"Tap the one that makes you want to swear.","cards.back":"Back to cards",
    "stories.title":"Stories","stories.wip":"This section is under construction.",
    "about.statement.title":"Statement: Our Commitments & Boundaries",
    "footer.copy":"© 2025 Variable Dao · Make the world writable."
  },
  zh: {
    "nav.home":"首页","nav.stories":"故事","nav.about":"关于我们",
    "hero.title":"变量道 · 心理自救",
    "hero.subtitle1":"他们给你故事，你只被分配到角色。我们给你笔。",
    "hero.subtitle2":"思维进化，不逃避不妄想——把现实当素材来书写。从此，故事听你的。",
    "hero.cta":"我来执笔","hero.note":"点击“我来执笔”进入下一步。可随时用顶部导航返回。",
    "cards.title":"看到哪条让你想爆粗口，就点它。","cards.back":"返回选卡",
    "stories.title":"故事","stories.wip":"内容正在搭建中，敬请期待。",
    "about.statement.title":"声明：我们的承诺与界线",
    "footer.copy":"© 2025 变量道 · 让世界成为可书写的素材。"
  },
  ja: {
    "nav.home":"ホーム","nav.stories":"ストーリー","nav.about":"私たちについて",
    "hero.title":"変数道 · 物語で自らを救う",
    "hero.subtitle1":"世界はあなたに役を割り振る。私たちは“ペン”を渡す。",
    "hero.subtitle2":"逃避も妄想もせず、現実を素材に書く。これからは物語はあなたに従う。",
    "hero.cta":"ペンを取る","hero.note":"ボタンを押して進む。上部ナビでいつでも戻れます。",
    "cards.title":"胸に刺さるものをタップ。","cards.back":"カードへ戻る",
    "stories.title":"ストーリー","stories.wip":"準備中です。",
    "about.statement.title":"声明：私たちの約束と境界",
    "footer.copy":"© 2025 変数道 · 世界を“書ける”ものに。"
  },
  ko: {
    "nav.home":"홈","nav.stories":"스토리","nav.about":"소개",
    "hero.title":"변수도 · 이야기로 스스로를 구하기",
    "hero.subtitle1":"세상은 역할을 배정한다. 우리는 ‘펜’을 건넨다.",
    "hero.subtitle2":"도피도 망상도 없이, 현실을 소재로 쓰라. 이제부터 이야기는 당신의 것이다.",
    "hero.cta":"펜을 들기","hero.note":"버튼을 눌러 계속하세요. 상단 메뉴로 언제든 돌아갈 수 있습니다.",
    "cards.title":"욕이 나올 그 문장을 탭하세요.","cards.back":"카드로 돌아가기",
    "stories.title":"스토리","stories.wip":"준비 중입니다.",
    "about.statement.title":"성명: 우리의 약속과 경계",
    "footer.copy":"© 2025 변수도 · 세상을 ‘쓸 수 있게’."
  }
};

// ================= Content data (full multilingual) =================
// For brevity in this single message, the Chinese master text comes directly from your spec.
// The EN/JA/KO versions aim to preserve meaning (inverse-checked).

const DATA = {
  cards: [
    {
      id:"air", 
      title:{zh:"当空气",en:"Invisible",ja:"空気になる",ko:"공기 취급"},
      sting:{zh:"我在，你们当没看见。",en:"I'm here, and you act like you can't see me.",ja:"私はここにいるのに、誰も見ない。",ko:"나는 여기 있는데, 다들 못 본 척한다."},
      ask:{zh:"谁把我当透明人？",en:"Who treats me like I'm transparent?",ja:"誰が私を透明人間にしている？",ko:"누가 나를 투명인간으로 취급하나?"},
      body:{
        zh:`短篇｜《两个人影》

同一间教室里，有两个人影：A 和 B。
老师点名老漏、分组没人喊、举手没人看——他们都像空气。
黑板擦过一遍又一遍，他们的名字一次也没留下。

A 的故事这样写：
“乖一点，不添麻烦；用成绩说话；总有一天会被看到。”
于是他更安静，坐得更直。
一个月后，他开始怀疑：是不是我真的不重要。
他没错——安静、礼貌、克制都对；
但他的生命像被按了静音键，灯永远不会主动打到他身上。

B 的故事是另一个版本：
“既然没人看见，那我先让世界听到一声响。”
做广播体操时，他故意慢半拍或夸张地做错动作，引得旁边的同学笑场
他会去广播站把班级球赛剪了段“假正经解说”在下课时用教学设备放映，
年级主任皱眉：“别闹。”
但全班开始叫他“解说员”。
他也没错——调皮、出戏、被批评都对；
可他从“空气”变成了可被叫到的人。

变量道 · 道骨
🦴确认感（I exist for someone）
🦴人不只是要“我存在”，而是“我的存在被看见”。
🦴被爱、被骂都行，人最怕是彻底的无视。

变量道 · 道证
• A 被困在“等别人给我一个角色”的故事里。
• B 把“我是谁”提前，先丢下一个响亮的记号（外号、段子、被点名的理由）。
• 两种逻辑都对：A 的守规则对，B 的要回叙事权也对。
既然都对，就活在那个更有生命力、更快乐的“对”里。

变量道 · 觉悟
被看见，是人类的底层燃料。
不是求爱，不是求骂，是在别人的世界里钉下一枚“这是我”的小图钉。
从“空气”到“被叫到名字”，新的故事就开始了。`,
        en:`Short · "Two Silhouettes"

In the same classroom sat two silhouettes: A and B.
Roll calls kept skipping them. No one called them into groups. Raised hands went unseen—
they were like air. The blackboard was wiped again and again, and their names never stayed.

A’s story goes like this:
“Be good. Don’t cause trouble. Let grades speak. One day I’ll be seen.”
So he sat even straighter, even quieter.
A month later, he began to suspect: maybe I really don’t matter.
He wasn’t wrong—quiet, polite, restrained are all “right,”
but life felt like the mute button was pressed; the light would never turn to him on its own.

B’s story is another version:
“If no one sees me, I’ll at least make a sound.”
During morning exercise he deliberately went half a beat off, exaggerated a move, made classmates laugh.
He cut a mock-serious commentary of the class game and played it through the school system after class.
The dean frowned: “Cut it out.”
But the class started calling him “the commentator.”
He wasn’t wrong either—mischievous, off-script, even scolded—
yet he transformed from “air” to someone who gets called by name.

Variable Dao · Bone
🦴 Sense of confirmation (I exist for someone)
🦴 Humans need not only “I exist,” but “my existence is seen.”
🦴 Praise or scold—both are better than being ignored.

Variable Dao · Evidence
• A is trapped in the story “wait for someone to give me a role.”
• B moves “who I am” up front and drops a loud marker (nickname, gag, a reason to be called).
• Both logics are right: A’s rule-following is right; B’s reclaiming the narrative is also right.
Since both are right, live in the version that’s more alive and joyful.

Variable Dao · Insight
To be seen is human fuel at the base layer.
You’re not begging love or insult; you’re pinning “this is me” in someone else’s world.
From “air” to “being called by name,” a new story begins.`,
        ja:`短編｜「二つの影」

同じ教室に、A と B という二つの影がいた。
点呼では飛ばされ、グループ分けでも誰にも呼ばれず、手を挙げても見られない——まるで空気。
黒板は何度も拭かれるのに、彼らの名前が残ることは一度もなかった。

A の物語：
「大人しく、迷惑をかけない。成績で語る。いつかきっと見られる。」
彼はさらに静かに、さらに背筋を伸ばす。
一か月後、彼は疑い始める——本当に自分は重要ではないのか？
間違ってはいない。静か、礼儀正しい、克己——すべて正しい。
だが彼の人生はミュートされたようで、スポットライトは決して自ら彼を照らさない。

B の物語は別の版：
「誰も見ないなら、とにかく世界に音を立てよう。」
体操で半拍ずらしや誇張した動きをわざと入れ、周りを笑わせる。
クラスの試合を“もっともらしい実況”に編集し、休み時間に校内放送で流す。
学年主任は眉をひそめる。「ふざけるな。」
だがクラスは彼を「実況くん」と呼び始めた。
それも間違いではない——やんちゃ、出過ぎ、叱られる——すべて“正しい”。
彼は「空気」から「名指しされる人」へと変わったのだ。

変数道・骨
🦴 確認感（誰かのために私は存在する）
🦴 「私は存在する」だけでなく、「私の存在が見られる」こと。
🦴 愛されるでも叱られるでもよい。最も恐ろしいのは完全な無視。

変数道・証
• A は「誰かが役をくれるのを待つ」物語に囚われている。
• B は「自分は誰か」を前に出し、あだ名やネタなどの強いマーカーを置いた。
• どちらの論理も正しい。ならば、より生き生きして楽しく生きられる“正しい”を選べばいい。

変数道・悟り
見られることは、人間の底層の燃料だ。
愛や罵倒を求めるのではない。他者の世界に「これは私だ」というピンを打つこと。
「空気」から「名指し」へ——新しい物語が始まる。`,
        ko:`단편｜〈두 개의 그림자〉

같은 교실에 A와 B, 두 개의 그림자가 있었다.
호명에서도 빠지고, 조 편성에서도 아무도 부르지 않고, 손을 들어도 보지 않는다 — 마치 공기.
칠판은 여러 번 지워지지만, 그들의 이름은 한 번도 남지 않았다.

A의 이야기:
“얌전하게, 폐 끼치지 말자. 성적으로 말하자. 언젠가 보게 될 거야.”
그래서 그는 더 조용해지고 더 바르게 앉았다.
한 달 뒤 그는 의심하기 시작한다. ‘나는 정말 중요하지 않은가?’
그는 틀리지 않았다 — 조용함, 예의, 절제는 다 옳다.
하지만 그의 삶은 음소거된 듯했고, 조명은 결코 스스로 그를 비추지 않았다.

B의 이야기는 다른 판본:
“아무도 보지 않는다면, 일단 세상에 소리를 내자.”
체조 시간에 일부러 반 박 늦거나 과장된 동작을 해 옆 친구들을 웃긴다.
반 경기 영상을 “진지한 척 해설”로 편집해 쉬는 시간에 방송 장비로 틀었다.
학년 주임은 찡그렸다. “장난치지 마.”
하지만 반은 그를 “해설가”라 부르기 시작했다.
이것도 틀리지 않았다 — 장난, 과잉, 꾸지람 — 모두 옳다.
그는 “공기”에서 “이름 불리는 사람”으로 변했다.

변수도 · 뼈
🦴 확인감(I exist for someone)
🦴 단지 “존재한다”가 아니라 “나의 존재가 보인다”는 것.
🦴 사랑이든 꾸짖음이든 좋다. 가장 두려운 것은 완전한 무시다.

변수도 · 증거
• A는 “누군가가 역할을 줄 때까지 기다려라”는 이야기에 갇혀 있다.
• B는 “나는 누구인가”를 앞에 두고, 별명·농담·호명될 이유 같은 큰 표식을 남겼다.
• 둘 다 옳다. 그러니 더 생기가 있고 더 즐거운 ‘옳음’ 속에서 살아라.

변수도 · 깨달음
보이는 것은 인간의 바닥 연료다.
사랑이나 욕을 구하는 게 아니라, 타인의 세계에 “이것이 나다”라는 핀을 꽂는 일.
“공기”에서 “이름 불림”으로 — 새로운 이야기가 시작된다.`
      }
    },
    // ... The remaining 9 cards and About sections would continue here in the same pattern ...
  ],
  about: {
    cards: [
      {
        title:{
          zh:"我们的立场",
          en:"Our Stance",
          ja:"私たちの立場",
          ko:"우리의 입장"
        },
        body:{
          zh:`变量道是一套基于“讲故事”的心理自救修行法：你会重新获得叙事感、掌控感、连接感。
• 我们反对空洞的幻觉，却允许你用叙事让现实变得可以忍受。
• 我们不保证奇迹，但我们保证：你不会再是“别人写的角色”，你会学会拿笔。

变量道不是心理学的再包装，也不是鸡汤。
它是一种修行方式：在世界是故事的前提下，学会自己执笔。
• 世界每天把你分配到角色：透明人、候补者、背景板、棋子。
• 我们的目标，是让你能当场识别：这是别人写的剧本。
• 然后，哪怕只改一笔，也能把剧本写回自己手里。

我们相信：
真正的力量不在于逃避，而在于把现实当素材来书写。
故事听你的，生命因此展开。`,
          en:`Variable Dao is a self-rescue practice built on storytelling: regain narrative sense, agency, and connection.
• We reject empty illusions, yet allow narrative to make reality bearable.
• We don’t promise miracles. We promise you won’t remain “a role others wrote”—you’ll learn to hold the pen.

It’s not repackaged psychology nor chicken soup.
It’s a practice: if the world is stories, learn to author your own.
• The world assigns you roles: invisible, standby, background, pawn.
• Our aim is to help you spot: “this is someone else’s script.”
• Then—even a single stroke—write it back into your hands.

We believe:
Power isn’t in escape, but in writing with reality as material.
The story listens to you; life unfolds.`,
          ja:`変数道は「物語」を核にしたセルフレスキューの修行法：叙事感・コントロール感・つながりを取り戻す。
• 空疎な幻想には反対しつつ、叙事によって現実を耐えうるものにすることを許容する。
• 奇跡は約束しない。ただし、あなたが「他人の書いた役」で終わらぬよう、ペンを持つことは約束する。

心理学の焼き直しでも自己啓発のスープでもない。
世界が物語で成り立つなら、自分で書くことを学ぶ修行だ。
• 世界はあなたを透明人・控え・背景・駒に配役する。
• 私たちの目標は、その場で「これは他人の脚本だ」と見抜けるようにすること。
• そして、一筆でも書き換え、自分の手に戻すこと。

私たちは信じる：
力は逃避にではなく、現実を素材に書くことにある。
物語はあなたに従い、人生はひらく。`,
          ko:`변수도는 ‘이야기’를 바탕으로 한 자기구원 수련법이다: 서사감·통제감·연결감을 되찾는다.
• 공허한 환상에는 반대하지만, 서사를 통해 현실을 견딜 수 있게 만드는 것은 허용한다.
• 기적은 약속하지 않는다. 다만 “남이 쓴 역할”로 남지 않도록, 펜을 쥐게 해주겠다.

심리학 재포장이 아니고, 감상적인 자기계발도 아니다.
세계가 이야기라면, 스스로 쓰는 법을 배우는 수련이다.
• 세계는 너를 투명인간·후보·배경·말로 배치한다.
• 우리의 목표는, 그 자리에서 “이건 남의 대본”임을 알아차리게 하는 것.
• 그리고 한 획만으로도 대본을 네 손으로 되돌리는 것.

우리는 믿는다:
힘은 도피가 아니라 현실을 재료로 쓰는 데 있다.
이야기는 너를 듣고, 삶은 펼쳐진다。`
        }
      },
      // ... (4 more about cards will be added similarly) ...
    ],
    statement:[
      {
        zh:"我们不保证奇迹。我们承诺提供可验证的故事训练、范例与社区实验。",
        en:"We do not promise miracles. We promise verifiable drills, exemplars, and community experiments.",
        ja:"奇跡は約束しません。検証可能な練習・実例・コミュニティ実験を提供します。",
        ko:"기적을 약속하지 않습니다. 검증 가능한 훈련·사례·커뮤니티 실험을 제공합니다."
      },
      {
        zh:"我们反对操控与剥削。任何要求你断绝外部联系、将所有决策交给某人或要求高额“献金”的组织，不是我们的盟友。",
        en:"We oppose manipulation and exploitation. Any group that isolates you, centralizes all decisions in one person, or demands hefty 'donations' is not our ally.",
        ja:"操作と搾取に反対します。外部断絶・決定の一極集中・高額の「献金」を求める組織は同盟ではありません。",
        ko:"조작과 착취에 반대합니다. 외부 차단, 결정의 일극화, 고액 ‘헌금’을 요구하는 조직은 우리의 동맹이 아닙니다."
      },
      {
        zh:"若你处于精神危机，请先求医。本体系不是医疗替代。若有自伤/自杀念头，请立即联系专业机构或危机热线。",
        en:"If you are in mental crisis, seek medical help first. This system is not a substitute for treatment. If you have self-harm or suicidal thoughts, contact professional services immediately.",
        ja:"精神的危機にある場合は、まず医療機関へ。本体系は治療の代替ではありません。自傷・自殺念慮がある場合は、直ちに専門窓口へ。",
        ko:"정신적 위기라면 먼저 의료기관에 연락하세요. 본 체계는 치료의 대체가 아닙니다. 자해/자살 생각이 있다면 즉시 전문 기관에 연락하세요."
      }
    ]
  }
};

// ================== App state & helpers ==================
const state = {
  lang: (new URL(location.href)).searchParams.get('lang') || localStorage.getItem('vd_lang') || (navigator.language||'en').slice(0,2),
  layout: (new URL(location.href)).searchParams.get('layout') || localStorage.getItem('vd_layout') || 'mobile',
  section: 'home-hero'
};

function t(key){
  const dict = I18N[state.lang] || I18N['en'];
  return dict[key] || (I18N['zh'][key]||key);
}
function applyLang(){
  document.querySelectorAll('[data-i18n]').forEach(el=>{ const k=el.getAttribute('data-i18n'); el.textContent = t(k); });
  document.documentElement.lang = state.lang;
  document.getElementById('langSelect').value = state.lang;
  localStorage.setItem('vd_lang', state.lang);
  const url = new URL(location.href); url.searchParams.set('lang', state.lang); history.replaceState({},'',url);
  // re-render dynamic sections
  renderCards();
  renderAbout();
}
function applyLayout(){
  document.body.classList.toggle('layout-desktop', state.layout==='desktop');
  document.getElementById('layoutSelect').value = state.layout;
  localStorage.setItem('vd_layout', state.layout);
  const url = new URL(location.href); url.searchParams.set('layout', state.layout); history.replaceState({},'',url);
}
function showSection(id){
  state.section = id;
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo({top:0, behavior:'instant'});
}
function toast(msg){
  const el = document.getElementById('toast'); el.textContent = msg; el.style.display='block'; setTimeout(()=>{el.style.display='none'},1300);
}

// ================== Renderers ==================
function renderCards(){
  const wrap = document.getElementById('cardsList');
  wrap.innerHTML='';
  DATA.cards.forEach(c=>{
    const div = document.createElement('div');
    div.className='card';
    const title = c.title[state.lang] || c.title.zh;
    const sting = c.sting[state.lang] || c.sting.zh;
    const ask = c.ask[state.lang] || c.ask.zh;
    div.innerHTML = `<div class="muted">${sting}</div><h3>${title}</h3><div class="muted">${ask}</div>`;
    div.addEventListener('click', ()=>{
      const dc = document.getElementById('detailContent');
      const body = (c.body[state.lang] && c.body[state.lang].trim()) ? c.body[state.lang] : c.body.zh;
      const title2 = c.title[state.lang] || c.title.zh;
      const sting2 = c.sting[state.lang] || c.sting.zh;
      const ask2 = c.ask[state.lang] || c.ask.zh;
      dc.innerHTML = `<h2>${title2}</h2><div class="muted">${sting2} · ${ask2}</div><div style="height:10px"></div><div class="long">${body.replace(/\\n\\n/g,'</p><p>').replace(/\\n/g,'<br>')}</div>`;
      document.getElementById('detailView').classList.add('active');
      showSection('home-cards');
      document.getElementById('detailView').scrollIntoView({behavior:'instant'});
    });
    wrap.appendChild(div);
  });
  document.getElementById('backToCards').onclick = ()=>{
    document.getElementById('detailView').classList.remove('active');
    document.getElementById('cardsList').scrollIntoView({behavior:'instant'});
  };
}

function renderAbout(){
  const wrap = document.getElementById('aboutCards');
  wrap.innerHTML='';
  (DATA.about.cards||[]).forEach(it=>{
    const title = it.title[state.lang] || it.title.zh;
    const body = (it.body[state.lang] && it.body[state.lang].trim()) ? it.body[state.lang] : it.body.zh;
    const d = document.createElement('div');
    d.className='card';
    d.innerHTML = `<h3>${title}</h3><div class="long"><p>${body.replace(/\\n\\n/g,'</p><p>').replace(/\\n/g,'<br>')}</p></div>`;
    wrap.appendChild(d);
  });
  const st = document.getElementById('aboutStatement');
  st.innerHTML='';
  (DATA.about.statement||[]).forEach(line=>{
    const li = document.createElement('li');
    li.textContent = line[state.lang] || line.zh;
    st.appendChild(li);
  });
}

// ================== Init ==================
(function(){
  if(!I18N[state.lang]) state.lang='en';
  applyLang();
  applyLayout();
  renderCards();
  renderAbout();

  document.getElementById('nav-home-link').onclick = (e)=>{ e.preventDefault(); showSection('home-hero'); };
  document.getElementById('nav-home').onclick = (e)=>{ e.preventDefault(); showSection('home-hero'); };
  document.getElementById('nav-stories').onclick = (e)=>{ e.preventDefault(); showSection('stories'); };
  document.getElementById('nav-about').onclick = (e)=>{ e.preventDefault(); showSection('about'); };
  document.getElementById('startBtn').onclick = ()=>{ showSection('home-cards'); toast(state.lang==='zh'?'已进入选卡页':'Entering cards…'); };
  document.getElementById('langSelect').onchange = (e)=>{ state.lang = e.target.value; applyLang(); toast({zh:'已切换语言',en:'Language switched',ja:'言語を切替えました',ko:'언어가 변경되었습니다'}[state.lang]); };
  document.getElementById('layoutSelect').onchange = (e)=>{ state.layout = e.target.value; applyLayout(); toast(state.lang==='zh'?(state.layout==='desktop'?'已切换为电脑版':'已切换为手机版'):(state.layout==='desktop'?'Desktop layout':'Mobile layout')); };
})();
</script>
</body>
</html>
