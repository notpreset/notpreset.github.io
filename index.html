
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>变量道 · Variable Dao</title>
<meta name="description" content="变量道 · 心理自救｜把现实当素材来书写。">
<style>
  :root{
    --maxw:900px;
    --pad:16px;
    --radius:14px;
    --muted:0.6;
    --accent: #4b6bfb;
  }
  html,body{margin:0;padding:0}
  body{
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", "PingFang SC","Hiragino Sans GB","Microsoft YaHei", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
    line-height:1.6;
    -webkit-font-smoothing: antialiased;
    color: #111;
    background: #fff;
  }
  @media (prefers-color-scheme: dark){
    body{ background:#0b0b0d; color:#eaeaf0;}
    .card, .panel { background:#141418; color:#eaeaf0; border-color:#24242a;}
    header, footer { background:#0b0b0d;}
    .muted{ color:rgba(234,234,240,var(--muted));}
    .btn{ color:#fff; }
  }
  a{ color:var(--accent); text-decoration:none}
  header{
    position:sticky; top:0; z-index:10;
    backdrop-filter: saturate(150%) blur(8px);
    background: rgba(255,255,255,0.7);
    border-bottom: 1px solid rgba(0,0,0,0.06);
  }
  @media (prefers-color-scheme: dark){
    header{ background: rgba(11,11,13,0.6); border-bottom:1px solid rgba(255,255,255,0.08);}
  }
  .nav{
    max-width:var(--maxw);
    margin:0 auto;
    padding: 10px var(--pad);
    display:flex; align-items:center; gap:10px;
  }
  .nav .grow{ flex:1 }
  .brand{ font-weight:700; letter-spacing:.2px}
  .nav a, .nav button, .nav select{
    font: inherit;
    background:transparent; border:0;
    color:inherit; cursor:pointer;
  }
  .chip{
    padding:6px 10px; border:1px solid rgba(0,0,0,.08); border-radius:20px;
  }
  @media (prefers-color-scheme: dark){
    .chip{ border-color: rgba(255,255,255,.12);}
  }
  .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .hero{
    max-width:var(--maxw);
    margin: 28px auto 16px;
    padding: 0 var(--pad);
  }
  .h1{
    font-size: clamp(28px, 4vw, 44px);
    line-height:1.15;
    font-weight:800;
    letter-spacing:.3px;
  }
  .lead{ font-size: clamp(15px,2.4vw,18px); opacity:.9; }
  .btn{
    display:inline-flex; align-items:center; gap:10px;
    padding:14px 18px; border-radius:14px;
    border:1px solid rgba(0,0,0,.08);
    background: linear-gradient(180deg,#fff,#f6f7fb);
    box-shadow: 0 8px 20px rgba(0,0,0,.08);
    font-weight:700;
  }
  .btn svg{ width:22px; height:22px }
  @media (prefers-color-scheme: dark){
    .btn{ background: linear-gradient(180deg,#1a1a1f,#121218); border-color:#24242a; box-shadow: 0 8px 28px rgba(0,0,0,.35);}
  }

  .panel{
    max-width:var(--maxw);
    margin: 8px auto 60px;
    padding: 0 var(--pad);
  }
  .cards{
    display:grid;
    grid-template-columns: 1fr;
    gap:14px;
  }
  .card{
    background:#fff;
    border:1px solid rgba(0,0,0,.08);
    border-radius: var(--radius);
    padding:14px 16px;
  }
  .card h3{ margin:6px 0 8px; font-size:18px}
  .card .tag{ font-size:12px; opacity:.7}
  .muted{ opacity:.7 }
  .detail{
    display:none;
  }
  .detail.active{ display:block }
  .detail .back{
    position:sticky; top:56px; z-index:9; margin-bottom:10px;
  }
  .back button{
    padding:10px 12px; border-radius:12px; border:1px solid rgba(0,0,0,.08);
  }
  .section{ display:none }
  .section.active{ display:block }
  footer{
    padding: 24px var(--pad) 60px;
    border-top:1px solid rgba(0,0,0,.06);
    margin-top:40px;
  }
  .footer-wrap{ max-width:var(--maxw); margin:0 auto }
  .foot-note{ opacity:.7; font-size:13px}

  /* Layout toggle (mobile vs desktop style) */
  body.layout-desktop .cards{ grid-template-columns: repeat(2,1fr);}
  body.layout-desktop .h1{ font-size:44px }
  body.layout-desktop .panel, body.layout-desktop .hero{ max-width: 1100px }
  /* compact long content paragraphs */
  .long p{ margin: 8px 0 }
  .note{ font-size: 13px; opacity:.7 }

  /* simple toast */
  #toast{ position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:rgba(20,20,30,.9); color:#fff; padding:8px 12px; border-radius:999px; font-size:13px; display:none }
</style>
</head>
<body>
<header>
  <div class="nav">
    <div class="brand"><a href="#" id="nav-home">变量道 · Variable Dao</a></div>
    <div class="grow"></div>
    <a class="chip" href="#" id="nav-home-btn" data-i18n="nav.home">首页</a>
    <a class="chip" href="#" id="nav-stories-btn" data-i18n="nav.stories">故事</a>
    <a class="chip" href="#" id="nav-about-btn" data-i18n="nav.about">关于我们</a>
    <div class="row">
      <select id="layoutSelect" class="chip" title="Layout">
        <option value="mobile">📱 Mobile</option>
        <option value="desktop">🖥️ Desktop</option>
      </select>
      <select id="langSelect" class="chip" title="Language">
        <option value="en">EN</option>
        <option value="zh">中文</option>
        <option value="ja">日本語</option>
        <option value="ko">한국어</option>
      </select>
    </div>
  </div>
</header>

<!-- HOME HERO (Step 1) -->
<section id="home-hero" class="section active">
  <div class="hero">
    <div class="h1" data-i18n="hero.title">变量道 · 心理自救</div>
    <p class="lead" data-i18n="hero.subtitle1">他们给你故事，你只被分配到角色。我们给你笔。</p>
    <p class="lead" data-i18n="hero.subtitle2">思维进化，不逃避不妄想——把现实当素材来书写。从此，故事听你的。</p>
    <div style="height:14px"></div>
    <button id="startBtn" class="btn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M12 19l7-7 3 3-7 7-3-1z" stroke-width="1.5"/>
        <path d="M3 21l6-2 11-11-4-4L5 15 3 21z" stroke-width="1.5"/>
      </svg>
      <span data-i18n="hero.cta">我来执笔</span>
    </button>
    <div class="note" style="margin-top:10px" data-i18n="hero.note">点击上面的“笔”按钮进入下一步。可随时用顶部导航返回。</div>
  </div>
</section>

<!-- HOME CARDS (Step 2) -->
<section id="home-cards" class="section">
  <div class="panel">
    <div class="h1" data-i18n="cards.title">看到哪条让你想爆粗口，就点它。</div>
    <div class="cards" id="cardsList">
      <!-- Card items are injected by JS from content data -->
    </div>
  </div>
  <!-- Detail view -->
  <div class="panel detail" id="detailView">
    <div class="back"><button id="backToCards">🔙 <span data-i18n="cards.back">返回选卡</span></button></div>
    <div id="detailContent" class="card long"></div>
  </div>
</section>

<!-- STORIES -->
<section id="stories" class="section">
  <div class="panel">
    <div class="card">
      <h3 data-i18n="stories.title">故事</h3>
      <p data-i18n="stories.wip">内容正在搭建中，敬请期待。</p>
    </div>
  </div>
</section>

<!-- ABOUT -->
<section id="about" class="section">
  <div class="panel">
    <div class="cards" id="aboutCards"></div>
  </div>
  <div class="panel">
    <div class="card">
      <h4 data-i18n="about.statement.title">声明：我们的承诺与界线</h4>
      <ul class="long">
        <li data-i18n="about.statement.li1">我们不保证奇迹。我们承诺提供可验证的故事训练、范例与社区实验。</li>
        <li data-i18n="about.statement.li2">我们反对操控与剥削。任何要求你断绝外部联系、将所有决策交给某人或要求高额“献金”的组织，不是我们的盟友。</li>
        <li data-i18n="about.statement.li3">若你处于精神危机，请先求医。本体系不是医疗替代。若有自伤/自杀念头，请立即联系专业机构或危机热线。</li>
      </ul>
      <p class="muted">Email: <a href="mailto:notpreset@outlook.com">notpreset@outlook.com</a></p>
    </div>
  </div>
</section>

<footer>
  <div class="footer-wrap">
    <div class="muted foot-note" data-i18n="footer.copy">© 2025 变量道 · 让世界成为可书写的素材。</div>
  </div>
</footer>

<div id="toast"></div>

<script>
/* ========= i18n ========= */
const I18N = {
  en: {
    "nav.home":"Home",
    "nav.stories":"Stories",
    "nav.about":"About",
    "hero.title":"Variable Dao · Self‑Rescue by Story",
    "hero.subtitle1":"They hand you a story and assign you a role. We hand you the pen.",
    "hero.subtitle2":"Evolve your thinking—no escapism, no delusion. Write with reality as your material. From now on, the story listens to you.",
    "hero.cta":"Take the Pen",
    "hero.note":"Click the pen to continue. Use the top nav anytime.",
    "cards.title":"Tap the line that makes you want to swear.",
    "cards.back":"Back to cards",
    "stories.title":"Stories",
    "stories.wip":"This section is under construction. Please stay tuned.",
    "about.statement.title":"Statement: Our Commitments & Boundaries",
    "about.statement.li1":"We do not promise miracles. We promise verifiable drills, exemplars, and community experiments.",
    "about.statement.li2":"We oppose manipulation and exploitation. Any group that isolates you, centralizes all decisions, or demands heavy 'donations' is not our ally.",
    "about.statement.li3":"If you are in crisis, seek medical help first. This is not a substitute for treatment. If you have self‑harm or suicidal thoughts, contact professional help immediately.",
    "footer.copy":"© 2025 Variable Dao · Make the world writable."
  },
  zh: {
    "nav.home":"首页",
    "nav.stories":"故事",
    "nav.about":"关于我们",
    "hero.title":"变量道 · 心理自救",
    "hero.subtitle1":"他们给你故事，你只被分配到角色。我们给你笔。",
    "hero.subtitle2":"思维进化，不逃避不妄想——把现实当素材来书写。从此，故事听你的。",
    "hero.cta":"我来执笔",
    "hero.note":"点击上面的“笔”按钮进入下一步。可随时用顶部导航返回。",
    "cards.title":"看到哪条让你想爆粗口，就点它。",
    "cards.back":"返回选卡",
    "stories.title":"故事",
    "stories.wip":"内容正在搭建中，敬请期待。",
    "about.statement.title":"声明：我们的承诺与界线",
    "about.statement.li1":"我们不保证奇迹。我们承诺提供可验证的故事训练、范例与社区实验。",
    "about.statement.li2":"我们反对操控与剥削。任何要求你断绝外部联系、将所有决策交给某人或要求高额“献金”的组织，不是我们的盟友。",
    "about.statement.li3":"若你处于精神危机，请先求医。本体系不是医疗替代。若有自伤/自杀念头，请立即联系专业机构或危机热线。",
    "footer.copy":"© 2025 变量道 · 让世界成为可书写的素材。"
  },
  ja: {
    "nav.home":"ホーム",
    "nav.stories":"ストーリー",
    "nav.about":"私たちについて",
    "hero.title":"変数道 · 物語で自らを救う",
    "hero.subtitle1":"世界はあなたに役を割り振る。私たちは“ペン”を渡す。",
    "hero.subtitle2":"逃避も妄想もせず、現実を素材に書く。これからは、物語はあなたに従う。",
    "hero.cta":"ペンを取る",
    "hero.note":"上のボタンをタップして進む。上部ナビでいつでも戻れます。",
    "cards.title":"胸に刺さるものをタップ。",
    "cards.back":"カードへ戻る",
    "stories.title":"ストーリー",
    "stories.wip":"準備中。しばらくお待ちください。",
    "about.statement.title":"声明：私たちの約束と境界",
    "about.statement.li1":"奇跡は約束しません。検証可能な練習・実例・実験を提供します。",
    "about.statement.li2":"操作と搾取に反対します。隔離や高額“献金”を迫る団体は同盟ではありません。",
    "about.statement.li3":"精神的危機の際は医療機関へ。本体系は治療の代替ではありません。",
    "footer.copy":"© 2025 変数道 · 世界を“書ける”ものに。"
  },
  ko: {
    "nav.home":"홈",
    "nav.stories":"스토리",
    "nav.about":"소개",
    "hero.title":"변수도 · 이야기로 스스로를 구하기",
    "hero.subtitle1":"세상은 역할을 배정한다. 우리는 ‘펜’을 건넨다.",
    "hero.subtitle2":"도피도 망상도 없이, 현실로 쓰라. 이제부터 이야기는 당신의 것이다.",
    "hero.cta":"펜을 들기",
    "hero.note":"위 버튼을 눌러 다음으로. 상단 메뉴로 언제든 돌아갈 수 있습니다.",
    "cards.title":"욕이 튀어나올 그 문장을 탭하세요.",
    "cards.back":"카드로 돌아가기",
    "stories.title":"스토리",
    "stories.wip":"준비 중입니다.",
    "about.statement.title":"성명: 우리의 약속과 경계",
    "about.statement.li1":"기적을 약속하지 않습니다. 검증 가능한 훈련·사례·실험을 제공합니다.",
    "about.statement.li2":"조작과 착취에 반대합니다. 고립을 강요하거나 거액의 ‘헌금’을 요구하는 조직은 동맹이 아닙니다.",
    "about.statement.li3":"위기 시에는 먼저 의료기관에 연락하세요. 본 체계는 치료의 대체가 아닙니다.",
    "footer.copy":"© 2025 변수도 · 세상을 ‘쓸 수 있게’."
  }
};

function t(key){
  const lang = state.lang;
  const dict = I18N[lang] || I18N['en'];
  return dict[key] || (I18N['zh'][key] || key);
}

/* ========= Content (ZH source; UI translated; content可后续补充多语) ========= */
const CARDS = [
  {
    key:"air",
    title:"当空气",
    sting:"我在，你们当没看见。",
    ask:"谁把我当透明人？",
    body:`<p><b>短篇｜《两个人影》</b></p>
<p>同一间教室里，有两个人影：A 和 B。老师点名老漏、分组没人喊、举手没人看——他们都像空气。黑板擦过一遍又一遍，他们的名字一次也没留下。</p>
<p>A 的故事这样写：<br>
“乖一点，不添麻烦；用成绩说话；总有一天会被看到。”<br>
于是他更安静，坐得更直。一个月后，他开始怀疑：是不是我真的不重要。他没错——安静、礼貌、克制都对；但他的生命像被按了静音键，灯永远不会主动打到他身上。</p>
<p>B 的故事是另一个版本：<br>
“既然没人看见，那我先让世界听到一声响。”<br>
做广播体操时，他故意慢半拍或夸张地做错动作，引得旁边的同学笑场；他会去广播站把班级球赛剪了段“假正经解说”在下课时用教学设备放映，年级主任皱眉：“别闹。”但全班开始叫他“解说员”。</p>
<p><b>变量道 · 道骨</b><br>🦴确认感（I exist for someone）</p>
<p><b>变量道 · 道证</b><br>• A 等角色；• B 丢下记号。</p>
<p><b>变量道 · 觉悟</b><br>被看见，是人类的底层燃料。从“空气”到“被叫到名字”，新的故事就开始了。</p>`
  },
  {
    key:"not-only",
    title:"不是唯一",
    sting:"永远候补，从没被偏爱。",
    ask:"在哪段关系里，我可替代到可笑？",
    body:`<p><b>A.案例｜《哈洛小猴子实验》</b></p>
<p>……（略述实验与“独一感”）</p>
<p><b>B.短篇｜《小舟的生日》</b></p>
<p>……（写下“专属一笔”）</p>
<p><b>变量道 · 道骨</b><br>🦴 偏心感（I matter more than average）</p>
<p><b>变量道 · 道证</b> • 接受“平等”与在平等里刻线。</p>
<p><b>变量道 · 觉悟</b><br>公平是安全带，偏心是燃料。若别人不给唯一，就自己刻一个。</p>`
  },
  {
    key:"no-reply",
    title:"石沉大海",
    sting:"说破喉咙，也没人回。",
    ask:"我最近一次“被已读不回”是什么事？",
    body:`<p><b>A.现实案例｜《被已读不回的母亲》</b></p>
<p>……责任分散效应……</p>
<p><b>B.变量道人物｜《阿昊的三秒钟》</b></p>
<p>……把沉默变成倒计时舞台……</p>
<p><b>变量道 · 道骨</b><br>🦴 回声感（I get an echo）</p>
<p><b>变量道 · 道证</b> • 等 vs 造场。</p>
<p><b>变量道 · 觉悟</b><br>回声不是天赐，而是你给世界一个“必须响的时刻”。</p>`
  },
  {
    key:"background",
    title:"活成背景",
    sting:"我的人生像别人的配角。",
    ask:"我在过谁写的故事？",
    body:`<p><b>A.现实案例｜《婚礼上的伴娘》</b></p>
<p>……没有一个字提到自己……</p>
<p><b>B.变量道人物｜《见证者的主角》</b></p>
<p>……“见证也是主角”……</p>
<p><b>变量道 · 道骨</b><br>🦴 叙事感（My life is a story）</p>
<p><b>变量道 · 道证</b> • 配角位置的转化。</p>
<p><b>变量道 · 觉悟</b><br>写自己的叙事，虚无被改写成章节。</p>`
  },
  {
    key:"puppet",
    title:"被人摆布",
    sting:"我做的一切都像被操控。",
    ask:"到底是谁在替我做决定？",
    body:`<p><b>A.现实案例｜《被剥夺的志愿》</b></p>
<p>……“师范稳定”与无发言权……</p>
<p><b>B.变量道人物｜《写回自己的镜头》</b></p>
<p>……用导演思维反击，病历备注“为作品取材”。</p>
<p><b>变量道 · 道骨</b><br>🦴 掌控感（I can influence outcomes）</p>
<p><b>变量道 · 道证</b> • 全局未变，插入署名。</p>
<p><b>变量道 · 觉悟</b><br>在剧本里插入你的一帧，证明“我写过”。</p>`
  },
  {
    key:"redundant",
    title:"多余之人",
    sting:"工作没人需要我，回家也一样。",
    ask:"我在哪件事上最被当“可有可无”？",
    body:`<p><b>短篇｜《炉火旁的身影》</b></p>
<p>……“火候师”的逆袭……</p>
<p><b>变量道 · 道骨</b><br>🔥 价值感（I am useful / valuable）</p>
<p><b>变量道 · 道证</b> • 角落里点亮你的光。</p>
<p><b>变量道 · 觉悟</b><br>火因你而稳，炉因你而成——存在的证明。</p>`
  },
  {
    key:"no-tribe",
    title:"无家可归",
    sting:"他们有圈子，我只有门外。",
    ask:"我本该属于那里，却一直在门口？",
    body:`<p><b>短篇｜《逐徒》</b></p>
<p>……“我们是彼此的靠山”。</p>
<p><b>变量道 · 道骨</b><br>🤝 归属感（I am part of a tribe）</p>
<p><b>变量道 · 道证</b> • 孤立久了，疯；孤立久了，创。</p>
<p><b>变量道 · 觉悟</b><br>为“家”立下故事，篝火即门。</p>`
  },
  {
    key:"void",
    title:"走进虚无",
    sting:"越努力越迷茫。",
    ask:"我现在到底在向哪里推进？",
    body:`<p><b>短篇｜《遗迹》</b></p>
<p>……石碑“虚无”，刻下“我们在此存在”。</p>
<p><b>变量道 · 道骨</b><br>🛰️ 方向感（I am going somewhere）</p>
<p><b>变量道 · 道证</b> • 终点改写成序章。</p>
<p><b>变量道 · 觉悟</b><br>方向不是外面给的。</p>`
  },
  {
    key:"no-light",
    title:"日子没光",
    sting:"每天都像复印，毫无仪式。",
    ask:"今天有什么值得让我停一下？",
    body:`<p><b>短篇｜《尼罗河之夜》</b></p>
<p>……点灯、献谷，给日常以敬意……</p>
<p><b>变量道 · 道骨</b><br>✨ 仪式感（This moment is sacred）</p>
<p><b>变量道 · 道证</b> • 选择的点亮。</p>
<p><b>变量道 · 觉悟</b><br>光要人点燃。</p>`
  },
  {
    key:"dust",
    title:"只是一粒尘",
    sting:"世界滚滚向前，没我也一样。",
    ask:"我和更大的东西还有连接吗？",
    body:`<p><b>系统文｜《无敌之后》</b></p>
<p>……从“为胜负”到“为守护”。</p>
<p><b>变量道 · 道骨</b><br>🌌 超越感（I touch something greater）</p>
<p><b>变量道 · 道证</b> • 把力量写进群体的故事。</p>
<p><b>变量道 · 觉悟</b><br>系统会过期，故事会流传。</p>`
  }
];

/* ABOUT cards content (condensed per user's outline) */
const ABOUT = [
  {
    title:"我们的立场",
    body:`<p>变量道是一套基于“讲故事”的心理自救修行法：你会重新获得叙事感、掌控感、连接感。</p>
    <ul class="long">
      <li>我们反对空洞的幻觉，却允许你用叙事让现实变得可以忍受。</li>
      <li>我们不保证奇迹，但我们保证：你不会再是“别人写的角色”，你会学会拿笔。</li>
    </ul>
    <p>变量道不是心理学的再包装，也不是鸡汤。它是一种修行方式：在世界是故事的前提下，学会自己执笔。</p>`
  },
  {
    title:"核心：不是认知疗法，是“写故事为主”的修行",
    body:`<ul class="long">
      <li>世界并非单一事实流，而是由叙事构成。</li>
      <li>成为作者：设定身份/目标/路线，并承担验证义务。</li>
    </ul>`
  },
  {
    title:"如何分辨「故事 / 妄想 / 骗局」",
    body:`<ol class="long">
      <li>可检验性（Reality anchor）</li>
      <li>外部回声（Echo test）</li>
      <li>可放大性（Replicability）</li>
      <li>利他/私利比（Benefit balance）</li>
      <li>时间耐受性（Time test）</li>
      <li>风险界线（Harm threshold）</li>
    </ol>`
  },
  {
    title:"怎么开始（马上能试的几个实验）",
    body:`<ol class="long">
      <li>刺句拆解：在刺痛话后加“这是他们写的，不是我写的”。</li>
      <li>舞台动作：心里给自己报幕。</li>
      <li>逆写标签：把“透明人”改写成“见证人”。</li>
      <li>一分钟写故事：填空写一行开头。</li>
    </ol>`
  },
  {
    title:"发起人介绍",
    body:`<p><b>🧘🏻道号 · 隐墨子</b> —— 隐匿以护方法之纯。</p>
    <p><b>🧘🏻道号 · 青隐客</b> —— “世界存在，因为我在写”。</p>`
  }
];

/* ========= State & helpers ========= */
const state = {
  lang: 'en',
  layout: 'mobile',
  currentSection: 'home-hero',
  previousSection: null
};

function detectLang(){
  const url = new URL(location.href);
  const fromUrl = url.searchParams.get('lang');
  const saved = localStorage.getItem('vd_lang');
  const nav = (navigator.language||'en').slice(0,2);
  return (fromUrl || saved || nav || 'en');
}
function detectLayout(){
  const url = new URL(location.href);
  const q = url.searchParams.get('layout');
  const saved = localStorage.getItem('vd_layout');
  return (q || saved || 'mobile');
}

function applyLang(){
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const k = el.getAttribute('data-i18n');
    el.textContent = t(k);
  });
  document.documentElement.lang = state.lang;
  document.getElementById('langSelect').value = state.lang;
  const url = new URL(location.href);
  url.searchParams.set('lang', state.lang);
  history.replaceState({}, '', url);
  localStorage.setItem('vd_lang', state.lang);
}
function applyLayout(){
  document.body.classList.toggle('layout-desktop', state.layout==='desktop');
  document.getElementById('layoutSelect').value = state.layout;
  const url = new URL(location.href);
  url.searchParams.set('layout', state.layout);
  history.replaceState({}, '', url);
  localStorage.setItem('vd_layout', state.layout);
}

/* ========= Router ========= */
function showSection(id){
  state.previousSection = state.currentSection;
  state.currentSection = id;
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo({top:0, behavior:'instant'});
}
function toast(msg){
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.style.display='block';
  setTimeout(()=>{ el.style.display='none'; }, 1400);
}

/* ========= Render Cards ========= */
function renderCards(){
  const wrap = document.getElementById('cardsList');
  wrap.innerHTML = '';
  CARDS.forEach(c=>{
    const div = document.createElement('div');
    div.className='card';
    div.innerHTML = `
      <div class="tag">${c.sting}</div>
      <h3>${c.title}</h3>
      <div class="muted">${c.ask}</div>
    `;
    div.addEventListener('click', ()=>{
      const content = document.getElementById('detailContent');
      content.innerHTML = `<h2>${c.title}</h2><div class="muted">${c.sting} · ${c.ask}</div><div style="height:10px"></div>${c.body}`;
      document.getElementById('detailView').classList.add('active');
      showSection('home-cards');
      document.getElementById('detailView').scrollIntoView({behavior:'instant'});
    });
    wrap.appendChild(div);
  });
  document.getElementById('backToCards').onclick = ()=>{
    document.getElementById('detailView').classList.remove('active');
    document.getElementById('cardsList').scrollIntoView({behavior:'instant'});
  };
}

function renderAbout(){
  const wrap = document.getElementById('aboutCards');
  wrap.innerHTML='';
  ABOUT.forEach(item=>{
    const div = document.createElement('div');
    div.className='card';
    div.innerHTML = `<h3>${item.title}</h3><div class="long">${item.body}</div>`;
    wrap.appendChild(div);
  });
}

/* ========= Init ========= */
(function(){
  state.lang = detectLang();
  state.layout = detectLayout();
  applyLang();
  applyLayout();
  renderCards();
  renderAbout();

  // Navbar
  document.getElementById('nav-home').addEventListener('click', e=>{ e.preventDefault(); showSection('home-hero'); });
  document.getElementById('nav-home-btn').addEventListener('click', e=>{ e.preventDefault(); showSection('home-hero'); });
  document.getElementById('nav-stories-btn').addEventListener('click', e=>{ e.preventDefault(); showSection('stories'); });
  document.getElementById('nav-about-btn').addEventListener('click', e=>{ e.preventDefault(); showSection('about'); });

  // Hero CTA -> cards (step2)
  document.getElementById('startBtn').addEventListener('click', ()=>{
    showSection('home-cards');
    toast(state.lang==='zh' ? '已进入选卡页' : 'Entering cards…');
  });

  // Lang + Layout
  document.getElementById('langSelect').addEventListener('change', (e)=>{
    state.lang = e.target.value;
    applyLang();
    toast({en:'Language switched', zh:'已切换语言', ja:'言語を切替えました', ko:'언어가 변경되었습니다'}[state.lang]||'OK');
  });
  document.getElementById('layoutSelect').addEventListener('change', (e)=>{
    state.layout = e.target.value;
    applyLayout();
    toast(state.lang==='zh' ? (state.layout==='desktop'?'已切换为电脑版':'已切换为手机版')
         : (state.layout==='desktop'?'Desktop layout':'Mobile layout'));
  });

  // Ensure home-cards cannot be accessed from nav directly (per spec),
  // so clicking Home always goes to hero (step1). Direct URL can still show due to anchor not used.
})();
</script>
</body>
</html>
